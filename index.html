<html>
  <head>
	  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>Frozen Framework ğŸ§Š</title>
		<link rel="icon" type="img/png" href=./img/icon.png>
		<link href="toc/style/github-bf51422f4bb36427d391e4b75a1daa083c2d840e.css" media="all" rel="stylesheet" type="text/css"/>
		<link href="toc/style/github2-d731afd4f624c99a4b19ad69f3083cd6d02b81d5.css" media="all" rel="stylesheet" type="text/css"/>
		<link href="toc/css/zTreeStyle/zTreeStyle.css" media="all" rel="stylesheet" type="text/css"/>
	  <style>
		pre {
		    counter-reset: line-numbering;
		    border: solid 1px #d9d9d9;
		    border-radius: 0;
		    background: #fff;
		    padding: 0;
		    line-height: 23px;
		    margin-bottom: 30px;
		    white-space: pre;
		    overflow-x: auto;
		    word-break: inherit;
		    word-wrap: inherit;
		}

		pre a::before {
		  content: counter(line-numbering);
		  counter-increment: line-numbering;
		  padding-right: 1em; /* space after numbers */
		  width: 25px;
		  text-align: right;
		  opacity: 0.7;
		  display: inline-block;
		  color: #aaa;
		  background: #eee;
		  margin-right: 16px;
		  padding: 2px 10px;
		  font-size: 13px;
		  -webkit-touch-callout: none;
		  -webkit-user-select: none;
		  -khtml-user-select: none;
		  -moz-user-select: none;
		  -ms-user-select: none;
		  user-select: none;
		}

		pre a:first-of-type::before {
		  padding-top: 10px;
		}

		pre a:last-of-type::before {
		  padding-bottom: 10px;
		}

		pre a:only-of-type::before {
		  padding: 10px;
		}

		.highlight { background-color: #ffffcc } /* RIGHT */
		</style>
  </head>
  <body>
	  <div>
				<div style='width:25%;'>
						<ul id="tree" class="ztree" style='width:100%'>

						</ul>
				</div>
        <div id='readme' style='width:70%;margin-left:20%;'>
          	<article class='markdown-body'>
            	<div align='center'>
    <font size='8'>Frozen Framework Document</font>
</div>

<center><img src="./img/icon.png" width="20%"></center>

<h1 id="1-frozen-">1. Frozenå›æµ‹æ¡†æ¶é€»è¾‘ä»‹ç»</h1>
<h2 id="1-1-">1.1 å¯¼å…¥å›æµ‹æ¡†æ¶</h2>
<pre><code>from Framework import *
</code></pre><h2 id="1-2-">1.2 å¸¸è§„ç¼–å†™æ­¥éª¤</h2>
<p>å¦‚å›¾ä¸ºFrozenç³»ç»Ÿä¸»ç•Œé¢ï¼š</p>
<center><img src="./img/ç³»ç»Ÿä¸»ç•Œé¢.png" alt="ç³»ç»Ÿä¸»ç•Œé¢" width="100%"></center>
<p>åœ¨terminalä¸­è¿è¡ŒFramework.pyæ–‡ä»¶ï¼Œç­‰å¾…æ•°æ®è·å–/æ›´æ–°ï¼Œå¾…è¿›åº¦æ¡å®Œæˆï¼Œè¾“å‡ºç­–ç•¥è¯„ä»·æŒ‡æ ‡å’Œå‡€å€¼æ›²çº¿å›¾ã€‚</p>
<center><img src="./img/æ¡†æ¶è¿è¡Œæµç¨‹.png" alt="æ¡†æ¶è¿è¡Œæµç¨‹" width="70%"></center>

<p><strong>ç³»ç»Ÿè¿è¡Œé€»è¾‘åŠæµç¨‹</strong>ï¼šé¦–å…ˆï¼Œåˆå§‹åŒ–Clientä¿¡æ¯ï¼Œå°†å‚æ•°ä¼ å…¥Frameworkï¼›æ¥ç€æ•°æ®æµé€šè¿‡apiç»è¿‡ç­›é€‰åŠé¢„å¤„ç†åä»Utilä¸­ä¼ å…¥AlphaBaseæ¨¡å—ï¼›åœ¨è¿™é‡Œè¿›è¡Œå› å­è®¡ç®—å’Œæ‰“åˆ†åç»§ç»­ä¼ å…¥Frameworkè¿›è¡Œé€‰è‚¡ï¼›ç„¶åFrameworkå°†ç›¸å…³æ•°æ®passç»™Optimizeï¼Œè®¡ç®—å‡ºæƒé‡åè¿”å›ç»™Frameworkè¿›è¡Œå¤„ç†ï¼›æœ€åæ ¹æ®ç­–ç•¥å›æµ‹æ”¶ç›Šè°ƒç”¨Utilçš„è¯„ä»·æŒ‡æ ‡è¾“å‡ºç»“æœåˆ†æã€‚</p>
<p>åˆå§‹åŒ–æ¡†æ¶å‚æ•°å¦‚ä¸‹ï¼š</p>
<pre><code class="lang-python"># Framework
index_code = &#39;tushareæ”¯æŒæŒ‡æ•°ç±»å‹&#39;
start_date = None
end_date = TODAY
max_stocks = 5
date_rule = 4
csv = True
html = True

# Util
PATH = &#39;./data cache&#39;
token = &#39;tushareç¤¾åŒºtoken&#39;

# Client
init_capital = 1e6
slippage = 0.0001
commission = 0.0003
stamp_duty = 0.001
ub = np.Inf
lb = -0.08
slippage_type = &#39;byRate&#39;
</code></pre>
<h2 id="1-3-">1.3 æ¨¡å—è¯´æ˜</h2>
<p>ä¸‹å›¾æ˜¾ç¤ºäº†å„æ¨¡å—ä¹‹é—´çš„è°ƒç”¨é€»è¾‘ï¼š</p>
<center><img src="./img/æ¨¡å—è°ƒç”¨é€»è¾‘å¼¦å›¾.png" alt="æ¨¡å—è°ƒç”¨é€»è¾‘å¼¦å›¾" width="50%"></center>

<h3 id="framework">Framework</h3>
<p><strong>Framework</strong>æ˜¯ç­–ç•¥æ¡†æ¶ï¼Œèµ·ç»Ÿç­¹è§„åˆ’çš„ä½œç”¨ã€‚å®ƒæœ‰ä¸¤ä¸ªä»»åŠ¡ï¼šè´Ÿè´£è®°å½•äº¤æ˜“çŠ¶æ€ï¼Œè®¡ç®—æ¯å¤©çš„æŸç›Šï¼Œç”Ÿæˆäº¤æ˜“æ—¥å¿—ï¼Œå¹¶æ ¹æ®æŒä»“è¾“å‡ºç»™å‡ºäº¤æ˜“ä¿¡å·ï¼›è¿›è¡Œç»©æ•ˆè¯„ä¼°ï¼Œç»˜åˆ¶ç­–ç•¥å‡€å€¼æ›²çº¿ï¼Œè®¡ç®—å„ç§è¯„ä»·æŒ‡æ ‡ã€‚</p>
<pre><code class="lang-python">Framework(index_code = &#39;000905.SH&#39;, start_date = &#39;20230101&#39;, end_date = &#39;20230726&#39;, max_stocks = 5, date_rule = 4)
</code></pre>
<p>Invoke Frozen backtest framework and initialize data flow.</p>
<blockquote>
<p> <strong>Parameters:</strong></p>
<ul>
<li>index_code (<code>str</code>) - String object denoting benchmark to trace</li>
<li>start_date (<code>str</code>, <em>optional</em>) - The strategy start date of format &quot;YYYYmmdd&quot;</li>
<li>end_date (<code>str</code>, <em>optional</em>) - The strategy end date of format &quot;YYYYmmdd&quot;</li>
<li>max_stocks (<code>int</code>, <em>defalut</em>: <code>5</code>) - Max number of stocks to hold, normally set larger than 3</li>
<li>date_rule (<code>int</code>, <em>defalut</em>: <code>4</code>) -  Day of week for position adjustment following the strategy weekday rule [&quot;1&quot;-&quot;Mon&quot;, &quot;2&quot;-&quot;Tue&quot;, &quot;3&quot;-&quot;Wed&quot;, &quot;4&quot;-&quot;Thu&quot;, &quot;5&quot;-&quot;Fri&quot;]</li>
</ul>
<p><strong>Returns:</strong></p>
<ul>
<li>Frozen framework (<code>class</code>)</li>
</ul>
</blockquote>
<pre><code class="lang-python">Framework.result_analysis(csv = True, html = False)
</code></pre>
<p>Quantify strategy performance by creating charts and plotting relevant graphs.</p>
<blockquote>
<p> <strong>Parameters:</strong></p>
<ul>
<li>csv (<code>boolean</code>, <em>default</em>: <code>True</code>) - If True, output .csv file including all stock positions</li>
<li>html (<code>boolean</code>, <em>default</em>: <code>False</code>) - If True, output .html file comprising strategy net value and all other evaluation indices</li>
</ul>
</blockquote>
<p>æ­¤å¤–ï¼ŒFrameworkä¼šè‡ªåŠ¨ç”Ÿæˆäº¤æ˜“æ—¥å¿—ï¼Œå¹¶å¯¹ç‰¹æ®Šçš„activitiesè¿›è¡Œè®°å½•ï¼Œé™¤æ—¥å¸¸INFOè®°å½•æŒä»“å¤–ï¼Œä¼šæœ‰ä»¥ä¸‹ä¸‰ä¸ªWARNINGçº§åˆ«çš„è®°å½•ï¼š</p>
<ul>
<li>Portfolio reallocation day is holiday, rebalancing deferred to next trading day.</li>
<li>Stop-loss point occurs for xxx on YYYY-mm-dd, closing long position.</li>
<li>Dividend incident occurs for xxx on YYYY-mm-dd</li>
</ul>
<h3 id="alphabase">AlphaBase</h3>
<p><strong>AlphaBase</strong>æ˜¯ç­–ç•¥ä¸»ä½“ï¼Œä¹Ÿæ˜¯æ•´ä¸ªç­–ç•¥çš„æ ¸å¿ƒã€‚æ‰€æœ‰çš„å› å­ç ”ç©¶ã€å› å­åˆæˆéƒ½åœ¨è¿™ä¸ªæ¨¡å—é‡Œè¿›è¡Œã€‚</p>
<pre><code class="lang-python">def factor_mining(self):
    wms = pd.DataFrame({tic: ((data[&#39;hfq_high&#39;].rolling(self.window).max() - data[&#39;hfq_close&#39;]) / (data[&#39;hfq_high&#39;].rolling(self.window).max() - data[&#39;hfq_low&#39;].rolling(self.window).min())) * 100 for tic, data in self.component.items()})
    roc = pd.DataFrame({tic: (data[&#39;hfq_close&#39;] - data[&#39;hfq_close&#39;].shift(self.window)) / data[&#39;hfq_close&#39;].shift(self.window) for tic, data in self.component.items()})

    wms = ((wms - wms.rolling(self.timestamp).min()) / (wms.rolling(self.timestamp).max() - wms.rolling(self.timestamp).min()))[self.start_date:self.end_date]
    roc = ((roc - roc.rolling(self.timestamp).min()) / (roc.rolling(self.timestamp).max() - roc.rolling(self.timestamp).min()))[self.start_date:self.end_date]

    score = 0.5 * wms + 0.5 * roc
    return score
</code></pre>
<p>è¿™é‡Œåœ¨è®¡ç®—å› å­å€¼æ—¶é‡‡ç”¨çš„æ˜¯pandasä¸­å¼ºå¤§çš„rollingæ–¹æ³•ï¼Œä¸€è¡Œä»£ç å³å¯è§£å†³ä¸€ä¸ªå› å­çš„è®¡ç®—ï¼›æ¥ç€éœ€è¦å¯¹å› å­è¿›è¡Œæ ‡å‡†åŒ–æˆ–å½’ä¸€åŒ–ï¼Œæ³¨æ„åœ¨è®¡ç®—ä¸­ä¸èƒ½å¼•å…¥æœªæ¥å‡½æ•°ï¼›æœ€åå°†æ‰€æœ‰å› å­åˆæˆï¼Œå¾—åˆ°æ¯åªè‚¡ç¥¨æ¯å¤©çš„å› å­å¾—åˆ†ã€‚</p>
<h3 id="optimize">Optimize</h3>
<p><strong>Optimize</strong>æ˜¯ç»„åˆä¼˜åŒ–æ¨¡å—ï¼Œèµ·é”¦ä¸Šæ·»èŠ±çš„ä½œç”¨ã€‚å®ƒåœ¨ä¸€å®šç¨‹åº¦ä¸Šå¯ä»¥ç¾åŒ–ç»„åˆæ”¶ç›Šã€‚è¯¥æ¨¡å—å°è£…äº†Markowitzçš„Mean-Varianceæ¡†æ¶ï¼Œapplyäº†åæ–¹å·®çŸ©é˜µä¼°è®¡çš„shrinkageæ–¹æ³•ã€‚</p>
<p>è¿™é‡Œçš„é€»è¾‘æ˜¯ï¼Œè€ƒè™‘åˆ°Aè‚¡ä¸èƒ½çº¯åšç©ºçš„ç‰¹æ€§ï¼ˆå¿½ç•¥èåˆ¸åšç©ºï¼‰ï¼Œæœ€å¤§åŒ–ç›®æ ‡å‡½æ•°ã€‚è¯¥é—®é¢˜çš„æœ¬è´¨æ˜¯å‡¸ä¼˜åŒ–é—®é¢˜ï¼Œé‡‡ç”¨SQPç®—æ³•æ•°å€¼è§£å‡ºæœ€ä¼˜æƒé‡ï¼Œå†è¾“å‡ºåˆ°æ¡†æ¶ä¸­ã€‚</p>
<p>$$ \underset {argmax \ \pmb{w}}{\max} \; \pmb{w^TR} - a \times \pmb{w^T} \pmb{\sum} \pmb{w} $$
$$ s.t.\ f(x)=\left\{\begin{aligned} w_i &amp; \in (0,1) \\ \sum w_i &amp; = 1 \end{aligned} \right. $$</p>
<p>å…¶ä¸­åæ–¹å·®çŸ©é˜µé‡‡ç”¨å¤æ‚åº¦è¾ƒä½çš„portfolio of estimatorsè¿›è¡Œä¼°è®¡ã€‚</p>
<h3 id="util">Util</h3>
<p><strong>Util</strong>æ˜¯ç­–ç•¥å®ç”¨æ¨¡å—ï¼Œèµ·åˆ°è¾…åŠ©çš„ä½œç”¨ã€‚è¯¥ç±»ä¸­å­˜æ”¾äº†ä¸€äº›åŠŸèƒ½æ€§å‡½æ•°ï¼Œå¦‚æ•°æ®è·å–/æ›´æ–°/å­˜å‚¨/è¯»å–ï¼Œä»¥åŠæ—¥å†è°ƒæ•´å’Œç­–ç•¥è¯„ä»·æŒ‡æ ‡ç­‰ã€‚</p>
<h3 id="client">Client</h3>
<p><strong>Client</strong>æ˜¯æ¨¡æ‹Ÿç»çºªå•†æ¨¡å—ï¼Œå……å½“brokerçš„ä½œç”¨ã€‚è¯¥ç±»ä¸­å­˜æ”¾äº†å®¢æˆ·çš„åŸºæœ¬ä¿¡æ¯ï¼Œå¦‚æœ¬é‡‘/æ‰‹ç»­è´¹/ä½£é‡‘ç­‰ï¼Œæ­¤å¤–è¿˜çº³å…¥äº†ç­–ç•¥é£æ§æœºåˆ¶ï¼ŒåŒ…æ‹¬æ»‘ç‚¹å¦‚ä½•ç¡®å®šï¼Œæ­¢æŸå‡½æ•°è®¾ç½®ï¼Œä»¥åŠäº¤æ˜“æ—¥å¿—åˆ›å»ºç­‰å†…å®¹ã€‚</p>
<h1 id="2-">2. ç­–ç•¥ç»©æ•ˆåˆ†æ</h1>
<h2 id="2-1-">2.1 è¾“å‡ºå½¢å¼</h2>
<p>æ¡†æ¶å…±æœ‰ä»¥ä¸‹äº”ç§å›æµ‹ç»“æœè¾“å‡ºï¼ŒåŒæ—¶æ„å»ºä¸€ä¸ªæœ¬åœ°æ•°æ®åº“ï¼š</p>
<p>ï¼ˆ1ï¼‰è¡¨æ ¼ï¼ˆtabulateï¼‰</p>
<p>åœ¨terminalä¸­ä»¥è¡¨æ ¼å½¢å¼æ‰“å°ç­–ç•¥è¯„ä»·æŒ‡æ ‡ã€‚</p>
<center><img src="./img/ç­–ç•¥æŒ‡æ ‡åˆ†æ.png" alt="ç­–ç•¥æŒ‡æ ‡åˆ†æ" width="80%"></center>
<p>ä»å·¦åˆ°å³åˆ†åˆ«ä¸ºï¼šç†è®ºå‡€å€¼ï¼Œè´¦æˆ·å‡€å€¼ï¼ŒåŸºå‡†å‡€å€¼ï¼Œå¹´åŒ–æ”¶ç›Šï¼Œbetaï¼Œalphaï¼Œå¤æ™®æ¯”ç‡ï¼Œç´¢æè¯ºæ¯”ç‡ï¼Œä¿¡æ¯æ¯”ç‡ï¼ˆIRï¼‰ï¼Œèƒœç‡ï¼Œæœ€å¤§å›æ’¤ã€‚</p>
<p>ï¼ˆ2ï¼‰å›¾ç‰‡ï¼ˆ.pngï¼‰</p>
<p>è¾“å‡ºç­–ç•¥å‡€å€¼æ›²çº¿ï¼Œå¯è‡ªè¡Œé€‰æ‹©æ˜¯å¦ä¿å­˜ä¸ºnet_value.pngã€‚</p>
<center><img src="./img/ç­–ç•¥å‡€å€¼æ›²çº¿.png" alt="ç­–ç•¥å‡€å€¼æ›²çº¿" width="70%"></center>

<p>å¦‚ä¸Šï¼Œå›¾ä¸­å…±æœ‰ä¸‰æ¡æ›²çº¿ï¼Œå…¶ä¸­ç»¿è‰²çº¿ä»£è¡¨ç­–ç•¥åŸºå‡†ï¼ˆè·Ÿè¸ªï¼‰å‡€å€¼ï¼›è“è‰²çº¿æ˜¯ç­–ç•¥ç†è®ºå‡€å€¼ï¼Œå³ä¸è€ƒè™‘äº¤æ˜“æˆæœ¬å’Œç°å®äº¤æ˜“æƒ…å†µï¼›æ©™è‰²çº¿æ˜¯è´¦æˆ·å‡€å€¼ï¼Œä¸ºä¸Šè´¹ï¼ˆæ‰‹ç»­è´¹ï¼Œä½£é‡‘ï¼Œå°èŠ±ç¨ç­‰ï¼‰åçš„ç°å®å‡€å€¼ã€‚</p>
<p>ï¼ˆ3ï¼‰æ—¥å¿—ï¼ˆ.logï¼‰</p>
<p>è‡ªåŠ¨åœ¨cwdä¸­åˆ›å»ºlogsæ–‡ä»¶å¤¹ï¼Œå…¶ä¸­åŒ…å«â€œindex_code + account_activities.logâ€æ–‡ä»¶ï¼Œå¦‚ä¸‹ä¸ºæ—¥å¿—ç¤ºä¾‹ï¼š</p>
<center><img src="./img/äº¤æ˜“æ—¥å¿—.png" alt="äº¤æ˜“æ—¥å¿—" width="70%"></center>

<p>ç›®å‰æ¡†æ¶å¯¹äºå½“å‘¨çš„å¤„ç†åªè®°å½•ä¹°å…¥ï¼Œåç»­ä¼šåŠ å…¥è·Ÿè¸ªï¼ˆtracingï¼‰çš„åŠŸèƒ½ã€‚</p>
<p>ï¼ˆ4ï¼‰Excelï¼ˆ.csvï¼‰</p>
<p>è‹¥æ‰€è®¾ç½®çš„<code>csv = True</code>ï¼Œåˆ™åœ¨cwdä¸­è‡ªåŠ¨åˆ›å»ºstock_orders.csvæ–‡ä»¶ã€‚é‡Œé¢è®°å½•äº†æ¯å‘¨çš„æŒä»“æ•°æ®ï¼ˆæ—¶é—´ã€è‚¡ç¥¨ä»£ç ã€æƒé‡ï¼‰ï¼ŒæŒ‰ç…§æ—¶é—´é¡ºåºæ’åˆ—ï¼Œæœ€æ–°æŒä»“å³ä¸ºå½“å‘¨æ¢ä»“éœ€æ±‚ï¼Œä¸€èˆ¬æ ¹æ®è¿™ä¸ªè¿›è¡Œäººå·¥ä¸‹å•ã€‚</p>
<p>ï¼ˆ5ï¼‰ç½‘é¡µï¼ˆ.htmlï¼‰</p>
<p>è‹¥æ‰€è®¾ç½®çš„<code>html = True</code>ï¼Œåˆ™åœ¨cwdä¸­è‡ªåŠ¨åˆ›å»ºtearsheet.htmlæ–‡ä»¶ã€‚è¯¥ç½‘é¡µç”±<a href="https://github.com/ranaroussi/quantstats">quantstats</a>åŒ…è‡ªåŠ¨ç”Ÿæˆï¼Œå…¶ä¸­åŒ…å«äº†å„ç§ç­–ç•¥è¯„ä»·æŒ‡æ ‡ä»¥åŠç»©æ•ˆè¯„ä¼°å›¾è¡¨ã€‚</p>
<p>ï¼ˆ6ï¼‰æ–‡ä»¶å¤¹ï¼ˆdata_cacheï¼‰</p>
<p>æ„å»ºæœ¬åœ°æ•°æ®åº“ï¼Œåœ¨cwdä¸­è‡ªåŠ¨åˆ›å»ºindex_codeæ–‡ä»¶å¤¹ï¼Œæ•°æ®å­˜å‚¨ä¸º.pklæ ¼å¼ã€‚</p>
<ul>
<li><p>index.pkl - åŸºå‡†æŒ‡æ•°dailyé‡ä»·æ•°æ®</p>
</li>
<li><p>component.pkl - æŒ‡æ•°æˆåˆ†è‚¡dailyé‡ä»·æ•°æ®</p>
</li>
<li><p>acct.pkl - æŒ‡æ•°æˆåˆ†è‚¡dailyä¼šè®¡æ•°æ®</p>
</li>
<li><p>dividend.pkl - æŒ‡æ•°æˆåˆ†è‚¡åˆ†çº¢è¯¦æƒ…</p>
</li>
</ul>
<h2 id="2-2-">2.2 æŒ‡æ ‡è®¡ç®—</h2>
<p>ä¸‹é¢å¯¹æŠ•èµ„ç­–ç•¥å›æµ‹å›¾ä¸­æ˜¾ç¤ºçš„ç­–ç•¥é£é™©è¯„ä»·æŒ‡æ ‡è®¡ç®—å…¬å¼ä½œç›¸å…³è¯´æ˜ï¼š</p>
<ul>
<li>ç»å¯¹æ”¶ç›Šç‡ï¼ˆAbsolute Returnsï¼‰ï¼šæ˜¯ç­–ç•¥åœ¨å›æµ‹æœŸé—´å†…å–å¾—çš„æ”¶ç›Šï¼Œå…¶è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š</li>
</ul>
<p>$$ AbsoluteReturn = \frac{P_{end} - P_{start}}{P_{start}} $$</p>
<ul>
<li>ç´¯è®¡æ”¶ç›Šç‡ï¼ˆCumulative Returnsï¼‰:</li>
</ul>
<p>$$ CumulativeReturn = \prod_{i=1}^{n}\, (1+p_i) - 1 $$</p>
<ul>
<li>å¹´åŒ–æ”¶ç›Šç‡ï¼ˆAnnualized Returnsï¼‰ï¼šæ˜¯ç­–ç•¥æŠ•èµ„æœŸé™ä¸ºä¸€å¹´æ‰€è·å¾—çš„æ”¶ç›Šï¼Œå…¶è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š</li>
</ul>
<p>$$ AnnualizedReturn = (\frac{P_{end}}{P_{start}})^{252/n} - 1 $$</p>
<ul>
<li>ç›¸å¯¹æ”¶ç›Šç‡ï¼ˆRelative Returnsï¼‰ï¼šæ˜¯ç­–ç•¥ç›¸å¯¹äºä¸šç»©æ¯”è¾ƒåŸºå‡†çš„æ”¶ç›Šï¼Œå…¶è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š</li>
</ul>
<p>$$ RelativeReturn = R_p - R_m $$</p>
<ul>
<li>Alphaå€¼ï¼šAlphaé‡åŒ–äº†äº¤æ˜“è€…ä»å¸‚åœºä¸­è·å¾—çš„ä¸å¸‚åœºèµ°åŠ¿æ— å…³çš„äº¤æ˜“å›æŠ¥ï¼Œå…¶è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š</li>
</ul>
<p>$$ Alpha = R_p - [R_f + \beta (R_m - R_f)] $$</p>
<ul>
<li>Betaå€¼ï¼šBataé‡åŒ–äº†æŠ•èµ„çš„ç³»ç»Ÿé£é™©ï¼Œå…¶è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š</li>
</ul>
<p>$$ \beta = \frac {Cov(R_{p_t}, R_{m_t})}{\sigma_{m_t}^2} $$</p>
<ul>
<li>æ”¶ç›Šæ³¢åŠ¨ç‡ï¼ˆVolatilityï¼‰ï¼šä¸»è¦ç”¨äºæµ‹é‡èµ„äº§çš„é£é™©ï¼Œæ³¢åŠ¨ç‡è¶Šé«˜ï¼Œé£é™©è¶Šå¤§ï¼Œå…¶è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š</li>
</ul>
<p>$$ \sigma_p = \sqrt{\frac{252}{n-1} \sum_{i=1}^n(p_i-\bar{p})^2} $$</p>
<ul>
<li>å¤æ™®æ¯”ç‡ï¼ˆSharpeï¼‰ï¼šSharpeä»£è¡¨äº¤æ˜“è€…æ¯å¤šæ‰¿æ‹…ä¸€ä»½é£é™©ï¼Œç›¸åº”çš„å°±å¯ä»¥æ‹¿åˆ°å‡ ä»½è¶…é¢æ”¶ç›Šï¼Œå…¶è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š</li>
</ul>
<p>$$ Sharpe = \frac{R_p - R_f}{\sigma_p} $$</p>
<ul>
<li>ä¿¡æ¯æ¯”ç‡ï¼ˆInformation Ratioï¼‰ï¼šç”¨äºè¡¡é‡å•ä½è¶…é¢é£é™©å¸¦æ¥çš„è¶…é¢æ”¶ç›Šï¼Œå…¶è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š</li>
</ul>
<p>$$ InformationRatio = \frac{R_p - R_m}{\sigma_t^{p-m}} $$</p>
<ul>
<li>ç´¢æè¯ºæ¯”ç‡ï¼ˆSortino Ratioï¼‰ï¼šä¸å¤æ™®æ¯”ç‡ç±»ä¼¼, ä¸åŒçš„æ˜¯åœ¨è®¡ç®—æ³¢åŠ¨ç‡æ—¶å®ƒé‡‡ç”¨çš„æ˜¯ä¸‹è¡Œæ ‡å‡†å·®ï¼Œå¯ä»¥çœ‹ä½œæ˜¯Sharpeçš„ä¸€ç§ä¿®æ­£æ–¹å¼ï¼Œå…¶è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š</li>
</ul>
<p>$$ SortinoRatio = \frac{R_p - R_f}{\sigma_d} $$</p>
<p>$$ \sigma_d = \sqrt{\frac{252}{n-1} \sum_{i=1}^n [min(p_i-R_f,0)]^2} $$</p>
<ul>
<li>èƒœç‡ï¼ˆWin Rateï¼‰ï¼šäº¤æ˜“ç›ˆåˆ©æ¬¡æ•°å æ€»äº¤æ˜“æ¬¡æ•°çš„æ¯”ä¾‹ï¼Œå…¶è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š</li>
</ul>
<p>$$ WinRate = \frac{N_{win}}{N_{total}} $$</p>
<ul>
<li>æœ€å¤§å›æ’¤ï¼ˆMax Drawdownï¼‰ï¼šç”¨äºè¡¡é‡ç­–ç•¥å¯èƒ½å‡ºç°çš„æœ€ç³Ÿç³•çš„æƒ…å†µï¼Œå…¶è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š</li>
</ul>
<p>$$ MaxDrawdown_t = max(1 - \frac{P_j}{P_i})\ , \quad t \geq j \geq i $$</p>
<h1 id="3-">3. å›æµ‹ç»†èŠ‚</h1>
<h2 id="3-1-">3.1 å›æµ‹æ—¶é—´è¯´æ˜</h2>
<h3 id="3-1-1-">3.1.1. ç­–ç•¥è°ƒä»“æ—¶é—´</h3>
<p>æˆ‘ä»¬çš„å›æµ‹æ¡†æ¶ä¸­ï¼Œè°ƒä»“å‘¨æœŸé»˜è®¤è®¾ç½®ä¸º<strong>å‘¨é¢‘</strong>ï¼Œä¸”æ ¹æ®å†å²å›æµ‹æ¥çœ‹ï¼Œåœ¨æ¯å‘¨å››è¿›è¡Œæ¢ä»“å–å¾—çš„æ•ˆæœæœ€å¥½ï¼Œå› æ­¤ç­–ç•¥é»˜è®¤æ¯å‘¨å››æŒ‰ç…§å½“å¤©å¼€ç›˜ä»·è¿›è¡Œå®šæœŸè°ƒä»“ã€‚</p>
<h3 id="3-1-2-">3.1.2. è°ƒä»“å‘¨æœŸè®¾ç½®</h3>
<p>å›æµ‹æ¡†æ¶é€šè¿‡<a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.resample.html#pandas.DataFrame.resample">pandas.DataFrame.resample</a>å‡½æ•°è¿›è¡Œè°ƒä»“å‘¨æœŸè®¾ç½®ã€‚</p>
<pre><code class="lang-python">weekly_score = score.resample(freq = self.date_rule).mean()
</code></pre>
<p>å‚æ•°å®Œå…¨ç»§æ‰¿resampleå‡½æ•°çš„è®¾ç½®ï¼Œ<code>freq</code>å–å€¼æœ‰&#39;B&#39;ï¼ˆæ—¥ï¼‰ã€&#39;W&#39;ï¼ˆå‘¨ï¼‰ã€&#39;M&#39;ï¼ˆæœˆï¼‰ç­‰ï¼Œè¿˜å¯ä»¥è®¾ç½®æ—¶é—´å‰ååç§»é‡<code>offset</code>ï¼Œæ‰€ä»¥è¯¥æ–¹æ³•é€‚ç”¨äºæ‰€æœ‰æœˆã€å‘¨ã€æ—¥ã€å°æ—¶è°ƒä»“ï¼Œè€Œä¸”è°ƒä»“å‘¨æœŸçš„è®¾ç½®ä¹Ÿæ›´ä¸ºçµæ´»å’Œå¤šæ ·ã€‚</p>
<p>ä»¥ä¸‹æ˜¯<code>freq</code>çš„ä¸€éƒ¨åˆ†å¯å–èŒƒå›´ï¼š</p>
<table>
<thead>
<tr>
<th style="text-align:center">Alias</th>
<th style="text-align:center">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">B</td>
<td style="text-align:center">business day frequency</td>
</tr>
<tr>
<td style="text-align:center">D</td>
<td style="text-align:center">calendar day frequency</td>
</tr>
<tr>
<td style="text-align:center">W</td>
<td style="text-align:center">weekly frequency</td>
</tr>
<tr>
<td style="text-align:center">M</td>
<td style="text-align:center">month end frequency</td>
</tr>
<tr>
<td style="text-align:center">SM</td>
<td style="text-align:center">semi-month end frequency (15th and end of month)</td>
</tr>
<tr>
<td style="text-align:center">Q</td>
<td style="text-align:center">quarter end frequency</td>
</tr>
<tr>
<td style="text-align:center">A, Y</td>
<td style="text-align:center">year end frequency</td>
</tr>
<tr>
<td style="text-align:center">H</td>
<td style="text-align:center">hourly frequency</td>
</tr>
<tr>
<td style="text-align:center">T, min</td>
<td style="text-align:center">minutely frequency</td>
</tr>
<tr>
<td style="text-align:center">S</td>
<td style="text-align:center">secondly frequency</td>
</tr>
</tbody>
</table>
<h2 id="3-2-">3.2 ä¸‹å•ï¼ˆè°ƒä»“ï¼‰</h2>
<h3 id="3-2-1-">3.2.1. ä¸‹å•æ–¹å¼</h3>
<p>æ–¹å¼ä¸€ï¼šäººå·¥æ‰‹åŠ¨ä¸‹å•</p>
<p>æ–¹å¼äºŒï¼šQMTæˆ–Ptradeè¿›è¡Œè‡ªåŠ¨ä¸‹å•</p>
<h3 id="3-2-2-">3.2.2. è°ƒä»“æ–¹å¼</h3>
<p>æ–¹å¼ä¸€ï¼šæŒ‰ä¹°å–è¯åˆ¸çš„æ•°é‡è¿›è¡Œè°ƒä»“ï¼ˆorderï¼‰ï¼Œæ¶‰åŠä¸‹å•å‡½æ•°ä¸­çš„<code>volume</code>å‚æ•°</p>
<p>æ–¹å¼äºŒï¼šæŒ‰æŒ‡å®šé‡‘é¢è°ƒä»“ï¼ˆorder_valueï¼‰ï¼Œæ¶‰åŠä¸‹å•å‡½æ•°ä¸­çš„<code>value</code>å‚æ•°</p>
<p>æ–¹å¼ä¸‰ï¼šæŒ‰æ€»èµ„äº§ç™¾åˆ†æ¯”è°ƒä»“ï¼ˆorder_percentï¼‰ï¼Œæ¶‰åŠä¸‹å•å‡½æ•°ä¸­çš„<code>percent</code>å‚æ•°</p>
<h3 id="3-2-3-">3.2.3. ä»“ä½é™åˆ¶</h3>
<p>ç”±äºAè‚¡å¸‚åœºçš„ç‰¹æ€§ï¼Œåœ¨è¿›è¡Œäº¤æ˜“æ—¶ï¼Œè‹¥æ ¹æ®Optimizeç»™å‡ºçš„æƒé‡ç®—å¾—çš„æŒä»“æ•°é‡å°äº1æ‰‹ï¼ˆ100è‚¡ï¼‰ï¼Œåˆ™ä¸è¿›è¡Œä¹°å…¥ï¼Œå¹¶ä»æŒä»“ä¸­å‰”é™¤ï¼Œå› æ­¤ï¼š</p>
<ul>
<li><p>ç­–ç•¥ç†è®ºå‡€å€¼æ›²çº¿ï¼šå‡è®¾èµ„é‡‘ä½¿ç”¨ç‡ä¸º100%</p>
</li>
<li><p>ç°å®è´¦æˆ·å‡€å€¼æ›²çº¿ï¼šåº”é¢„ç•™è¶³å¤Ÿçš„ç°é‡‘ä»¥coveräº¤æ˜“è´¹ç”¨ï¼ˆæ‰‹ç»­è´¹åŠç¨è´¹ï¼‰ï¼Œæ‰€ä»¥ä¸€èˆ¬èµ„é‡‘æ— æ³•å…¨éƒ¨æŠ•å…¥ä½¿ç”¨</p>
</li>
</ul>
<h3 id="3-2-4-">3.2.4. å§”æ‰˜ä»·æ ¼</h3>
<p>é€šè¿‡è®¾ç½®ä¸‹å•å‡½æ•°ä¸­çš„<code>price</code>å‚æ•°è®¾ç½®å§”æ‰˜ä»·æ ¼ï¼Œå†ç»“åˆè®¾ç½®çš„æ»‘ç‚¹ï¼Œç¡®å®šæœ€ç»ˆçš„æˆäº¤ä»·ã€‚</p>
<p>å§”æ‰˜ä»·æ ¼priceæ—¢å¯ä»¥è‡ªè¡Œè®¾å®šä»·æ ¼ï¼Œä¹Ÿå¯ä»¥å°†ä¸‹å•æ—¥çš„&#39;open&#39;ï¼ˆå¼€ç›˜ä»·ï¼‰ï¼Œ&#39;vwap&#39;ï¼ˆå‡ä»·ï¼‰ï¼Œæˆ–å‰ä¸€äº¤æ˜“æ—¥çš„&#39;close&#39;ï¼ˆæ”¶ç›˜ä»·ï¼‰ä½œä¸ºå§”æ‰˜ä»·æ ¼ï¼Œæ‰€ä»¥å§”æ‰˜ä»·æ ¼å…±æœ‰4ç§è®¾ç½®æ–¹å¼ï¼Œèƒ½å¾ˆå¥½åœ°æ»¡è¶³å„ç§éœ€æ±‚ã€‚</p>
<p>å›æµ‹æœŸé—´é»˜è®¤ä»¥ä¸Šä¸€äº¤æ˜“æ—¥æ”¶ç›˜ä»·ä½œä¸ºæˆäº¤ä»·ç»“ç®—ï¼Œä½†ç”±äºå¯èƒ½å­˜åœ¨æŒç»­æŒä»“çš„æƒ…å†µï¼Œä¸”å®ç›˜ä¸­ä¹°å–æ“ä½œå‡äºå½“æ—¥æ‰§è¡Œï¼Œå› æ­¤é‡‡ç”¨å½“æ—¥å¼€ç›˜ä»·ä½œä¸ºå§”æ‰˜ä»·æ›´åŠ åˆç†ï¼ˆto be discussedï¼‰ã€‚</p>
<h3 id="3-2-5-">3.2.5. ä¹°å–æ–¹å‘</h3>
<p>ä¸€èˆ¬é€šè¿‡ä¸‹å•å‡½æ•°ä¸­çš„<code>trade_side</code>å‚æ•°æ¥è®¾ç½®ä¹°å–æ–¹å‘ï¼Œä¹°å–æ–¹å‘å…±æœ‰2ç§ï¼š&#39;buy&#39;ï¼šå¼€å¤šã€&#39;short&#39;ï¼šå¼€ç©ºã€‚</p>
<p>ä½†ç”±äºæ¡†æ¶åªæ”¯æŒçº¯å¤šå¤´ç­–ç•¥ï¼Œæ‰€ä»¥å–å–æ–¹å‘ä»…é™&#39;buy&#39;ã€‚</p>
<h3 id="3-2-6-">3.2.6. æ¶¨è·Œåœ</h3>
<p>å¯¹äºåœç‰Œæˆ–æ˜¯è·Œåœçš„è‚¡ç¥¨ï¼Œå›æµ‹ç³»ç»Ÿä¼šå¯¹å…¶è‡ªåŠ¨åˆ é™¤ï¼Œä¸è¿›è¡Œä¹°å–äº¤æ˜“ï¼›æ¶¨åœè‚¡ç¥¨ä»å¯ä»¥æ¶¨åœä»·ä¹°å…¥ã€‚</p>
<h3 id="3-2-7-">3.2.7. é€€å¸‚</h3>
<p>åœ¨å›æµ‹è¿‡ç¨‹ä¸­ï¼Œè‹¥æŒä»“ä¸­å‡ºç°é€€å¸‚è‚¡ç¥¨ï¼Œå›æµ‹ç³»ç»Ÿä¼šå°†é€€å¸‚è‚¡ç¥¨æŒ‰<strong>æœ€åä¸€ä¸ªäº¤æ˜“æ—¥çš„æ”¶ç›˜ä»·</strong>ä½œä¸ºé€€å¸‚ä»·æ ¼è¿›è¡Œæ¸…ä»“å¤„ç†ã€‚</p>
<h2 id="3-3-">3.3 æŒä»“æœŸé—´è°ƒæ•´</h2>
<h3 id="3-3-1-">3.3.1. æ»‘ç‚¹</h3>
<p>é€šè¿‡Clientä¸­çš„apply_slippageå¯¹è±¡å±æ€§æ¥è®¾ç½®æ»‘ç‚¹ï¼š</p>
<pre><code class="lang-python">def apply_slippage(self, price, pct_slippage, slippage_type):
    if slippage_type == &#39;byRate&#39;:
        price_with_slippage = price * (1 + pct_slippage)
    elif slippage_type == &#39;byVolume&#39;:
        price_with_slippage = price + pct_slippage
    else:
        print(&#39;Please indicate which slippage type.&#39;)
    return price_with_slippage
</code></pre>
<p>å…±æœ‰ä¸¤ç§æ»‘ç‚¹è®¾ç½®ç±»å‹ï¼š<code>byRate</code>å’Œ<code>byVolume</code></p>
<ul>
<li><p>ç™¾åˆ†æ¯”ï¼ˆ<code>byRate</code>ï¼‰ï¼šå¦‚è®¾ç½®çš„<code>slippage_type = &#39;byRate&#39;</code>ï¼Œ<code>pct_slippage = 0.0001</code>ï¼Œä¹°å–äº¤æ˜“æ—¶çš„æˆäº¤ä»·ä¸ºå§”æ‰˜ä»·æ ¼åŠ ä¸Šå§”æ‰˜ä»·çš„0.01%</p>
</li>
<li><p>å›ºå®šé‡‘é¢ï¼ˆ<code>byVolume</code>ï¼‰: å¦‚è®¾ç½®çš„<code>slippage_type = &#39;byVolume&#39;</code>ï¼Œ<code>pct_slippage = 0.02</code>ï¼Œä¹°å–äº¤æ˜“æ—¶çš„æˆäº¤ä»·ä¸ºå§”æ‰˜ä»·æ ¼åŠ ä¸Š0.02</p>
</li>
</ul>
<p>Frozenæ¡†æ¶é»˜è®¤æŒ‰ç…§byRate 1bpè¿›è¡Œè®¾ç½®ï¼Œæ¯”è¾ƒç¬¦åˆè‚¡ç¥¨å¸‚åœºçš„æƒ¯ä¾‹ã€‚</p>
<h3 id="3-3-2-">3.3.2. æ‹†åˆ†åˆå¹¶ä¸åˆ†çº¢</h3>
<p>å½“è‚¡ç¥¨å‘ç”Ÿæ‹†åˆ†ï¼Œåˆå¹¶æˆ–æ˜¯åˆ†çº¢é…è‚¡æ—¶ï¼Œè‚¡ç¥¨ä»·æ ¼ä¼šå‘ç”Ÿè¾ƒå¤§çš„å˜åŠ¨ï¼Œä½¿å¾—å½“å‰ä»·æ ¼å˜å¾—ä¸è¿ç»­ï¼Œè¿™æ—¶æˆ‘ä»¬ä¼šå¯¹ä»·æ ¼è¿›è¡Œå¤æƒæ¥ä¿æŒä»·æ ¼çš„è¿ç»­æ€§ï¼Œæ‰€ä»¥å›æµ‹è¿‡ç¨‹ä¸­æå–å†å²è¡Œæƒ…æ•°æ®æ—¶ï¼Œå¯ä»¥é€‰æ‹©æ˜¯å¦é‡‡ç”¨å®šç‚¹å¤æƒæ¥ä¿æŒä»·æ ¼çš„è¿ç»­æ€§ã€‚</p>
<p>åœ¨ä¸‹å•äº¤æ˜“æ—¶ï¼Œä¸ºä¿è¯å›æµ‹çš„çœŸå®æ€§ï¼Œè®¾ç½®çš„å§”æ‰˜ä»·ä½¿ç”¨çš„ä»æ˜¯çœŸå®çš„è¡Œæƒ…æ•°æ®ï¼Œæ²¡æœ‰ç»è¿‡å¤æƒå¤„ç†ã€‚</p>
<p>å®šç‚¹å¤æƒå…·ä½“æ“ä½œï¼šå®šç‚¹å¤æƒä¸€èˆ¬æ˜¯å¯¹å®šç‚¹ä¹‹å‰çš„ä»·æ ¼è¿›è¡Œå‰å¤æƒå¤„ç†ï¼Œå¯¹å®šç‚¹ä¹‹åçš„ä»·æ ¼ä¿æŒä¸å˜ï¼Œè‹¥å®šç‚¹ä¹‹åé‡åˆ°é™¤æƒé™¤æ¯æ—¥ï¼Œåˆ™è¿›è¡Œåå¤æƒå¤„ç†ã€‚</p>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œä½¿ç”¨åå¤æƒä»·è®¡ç®—è‚¡ç¥¨æ”¶ç›Šç‡ï¼Œä»è€Œè·å¾—ç­–ç•¥ç†è®ºå‡€å€¼ï¼›æ­¤å¤–ï¼Œåå¤æƒä»·è¿˜è¢«ç”¨æ¥è®¡ç®—ç­–ç•¥èƒœç‡ï¼ˆæœªåŒ…å«å½“å‘¨ï¼‰ï¼Œæ³¨æ„è¦è€ƒè™‘æ»‘ç‚¹å’Œæ‰‹ç»­è´¹ã€‚è€ŒçœŸå®ä»·æ ¼ï¼ˆä¸å¤æƒï¼‰åˆ™ç”¨äºäº¤æ˜“ï¼Œå¾—åˆ°ç°å®è´¦æˆ·å‡€å€¼ã€‚</p>
<p>åœ¨ç­–ç•¥æŒæœ‰æœŸé—´ï¼Œè‹¥æŒä»“è‚¡ç¥¨å‡ºç°åˆ†çº¢é€è‚¡çš„æƒ…å†µï¼Œéœ€è¦å¯¹æŒè‚¡æ•°é‡å’Œå¯ç”¨ç°é‡‘è¿›è¡Œè°ƒæ•´ï¼š</p>
<pre><code class="lang-python">num_shares *=ï¼ˆ1 + stk_divï¼‰
avail_cash += cash_div
</code></pre>
<h3 id="3-3-3-">3.3.3. äº¤æ˜“ç¨è´¹</h3>
<p>å¯é€šè¿‡Clientä¸­çš„<code>commission</code>å‚æ•°æ¥è®¾ç½®äº¤æ˜“è´¹ç”¨ï¼Œé»˜è®¤æƒ…å†µä¸º0.0003ï¼ŒåŒè¾¹å¾æ”¶ï¼›é€šè¿‡<code>stamp_duty</code>è®¾ç½®ç¨è´¹ï¼Œé»˜è®¤ä¸º0.001ï¼Œå‘å–æ–¹å•è¾¹å¾æ”¶ã€‚</p>
<ul>
<li><p>ä¹°å…¥ï¼šä»…éœ€æ”¶å–æ‰‹ç»­è´¹</p>
</li>
<li><p>å–å‡ºï¼šè¯¥è´¹ç”¨æ˜¯ä½£é‡‘å’Œç¨è´¹çš„ç»¼åˆè´¹ç”¨ï¼Œä¸ºæ‰‹ç»­è´¹+å°èŠ±ç¨</p>
</li>
</ul>
<p>è¿ç»­æŒä»“çš„æ‰‹ç»­è´¹å‡å…è°ƒæ•´ï¼šè‹¥è¿ç»­ä¸¤å‘¨å…·æœ‰ç›¸åŒæŒä»“æˆ–æŒä»“äº¤å‰ï¼Œåˆ™åœ¨è°ƒä»“æ—¥ä¸éœ€è¦è¿›è¡Œé‡å¤ä¹°å–ï¼Œå¯ä»¥çœå»ä¸€éƒ¨åˆ†æ‰‹ç»­è´¹çš„æ”¯å‡ºã€‚</p>
<h3 id="3-3-4-">3.3.4. æ­¢ç›ˆæ­¢æŸ</h3>
<p>å›æµ‹æ¡†æ¶åˆ†åˆ«è®¾ç½®äº†å¯¹ä»·æ ¼ï¼ˆpriceï¼‰å’Œå¯¹æ”¶ç›Šç‡ï¼ˆreturnï¼‰çš„æ­¢ç›ˆå’Œæ­¢æŸå‡½æ•°ï¼Œä»è€Œè¿›è¡Œé£é™©æ§åˆ¶ã€‚</p>
<p>ä»¥å¯¹æ”¶ç›Šç‡çš„æ­¢ç›ˆæ­¢æŸå‡½æ•°ä¸ºä¾‹ï¼š</p>
<pre><code class="lang-python">def pnl_lim(self, ret):
    PROFIT_LIMIT = np.array(np.where(ret&gt;=self.upper_bound))
    LOSS_LIMIT = np.array(np.where(ret&lt;=self.lower_bound))
    ret_filter = ret.copy()
    for idx in np.hstack([LOSS_LIMIT, PROFIT_LIMIT]).T:
        ret_filter.iloc[idx[0]+1:,idx[1]] = 0
    return ret_filter
</code></pre>
<p>ç­–ç•¥é»˜è®¤å¯¹äºå•åªè‚¡ç¥¨æ— ç›ˆåˆ©é™åˆ¶ï¼ˆ<code>ub = np.Inf</code>ï¼‰ï¼Œè€ŒäºæŸé™åˆ¶ä¸º-80%ï¼ˆ<code>lb = -0.8</code>ï¼‰ï¼Œæ•´ä½“äºæŸé™åˆ¶ä¸º-20%ï¼ˆ<code>total_loss = -0.2</code>ï¼‰ã€‚</p>

          	</article>
        </div>
		</div>
	<script
		src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS_HTML"
		async
	></script>

	<script type="text/x-mathjax-config;executed=true">
		window.MathJax.Hub.Config({
			showProcessingMessages: false, //å…³é—­jsåŠ è½½è¿‡ç¨‹ä¿¡æ¯
			messageStyle: "none", //ä¸æ˜¾ç¤ºä¿¡æ¯
			jax: ["input/TeX", "output/HTML-CSS"],
			tex2jax: {
				inlineMath: [["$", "$"], ["\\(", "\\)"]], //è¡Œå†…å…¬å¼é€‰æ‹©ç¬¦
				displayMath: [["$$", "$$"], ["\\[", "\\]"]], //æ®µå†…å…¬å¼é€‰æ‹©ç¬¦
				skipTags: ["script", "noscript", "style", "textarea", "pre", "code", "a"] //é¿å¼€æŸäº›æ ‡ç­¾
			},
			"HTML-CSS": {
				availableFonts: ["STIX", "TeX"], //å¯é€‰å­—ä½“
				showMathMenu: false //å…³é—­å³å‡»èœå•æ˜¾ç¤º
			}
		});
		//ä¸‹é¢ç¬¬ä¸‰ä¸ªå‚æ•°å¯ä»¥ä¸å†™ï¼Œé»˜è®¤å¯¹æ•´ä¸ªhtmlå†…çš„latexè¿›è¡Œç¿»è¯‘
		window.MathJax.Hub.Queue(["Typeset", MathJax.Hub,document.getElementsByClassName("ck-content")]);
	</script>
  </body>
</html>
<script type="text/javascript" src="toc/js/jquery-1.4.4.min.js"></script>
<script type="text/javascript" src="toc/js/jquery.ztree.all-3.5.min.js"></script>
<script type="text/javascript" src="toc/js/ztree_toc.js"></script>
<script type="text/javascript" src="toc_conf.js"></script>

<SCRIPT type="text/javascript" >
<!--
$(document).ready(function(){
    var css_conf = eval(markdown_panel_style);
    $('#readme').css(css_conf)
    
    var conf = eval(jquery_ztree_toc_opts);
		$('#tree').ztree_toc(conf);
});
//-->
</SCRIPT>